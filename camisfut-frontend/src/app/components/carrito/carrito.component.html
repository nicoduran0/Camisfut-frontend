<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-light bg-white border-bottom barra-navegacion">
  <div class="container d-flex align-items-center">
    <a class="navbar-brand logo-navegacion" routerLink="/inicio">
      <img src="img/logo_camis.png" alt="CamisFut">
    </a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav me-auto">
        <li class="nav-item"><a class="nav-link" routerLink="/inicio">Inicio</a></li>
        <li class="nav-item"><a class="nav-link" routerLink="/catalogo">Catálogo</a></li>
        <li class="nav-item"><a class="nav-link" routerLink="/colecciones">Colecciones</a></li>
        <li class="nav-item"><a class="nav-link" routerLink="/nosotros">Nosotros</a></li>
      </ul>
      <div class="d-flex align-items-center">
        <!-- Perfil si logueado -->
        <div *ngIf="isLoggedIn" class="dropdown">
          <button class="btn btn-outline-secondary d-flex align-items-center justify-content-center dropdown-toggle"
                  style="height:40px;width:40px" type="button" data-bs-toggle="dropdown" aria-expanded="false">
            <i class="bi bi-person"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end">
            <li><span class="dropdown-item-text">Hola, {{userName}}</span></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item" routerLink="/mis-pedidos"><i class="bi bi-bag me-2"></i>Mis Pedidos</a></li>
            <li><button class="dropdown-item text-danger" (click)="logout()">
              <i class="bi bi-box-arrow-right me-2"></i>Cerrar Sesión
            </button></li>
          </ul>
        </div>

        <!-- Iniciar sesión si no logueado -->
        <a *ngIf="!isLoggedIn" routerLink="/inicio-sesion" class="btn btn-inicio-sesion me-3">Iniciar Sesión</a>

        <!-- Carrito -->
        <button class="btn btn-outline-secondary d-flex align-items-center justify-content-center position-relative"
                style="height:40px;width:40px" routerLink="/carrito">
          <i class="bi bi-cart"></i>
          <span *ngIf="totalArticulos > 0"
                class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger"
                style="font-size:0.6rem">{{ totalArticulos }}</span>
        </button>
      </div>
    </div>
  </div>
</nav>

<!-- Contenido principal -->
<div class="container my-5">
  <div class="text-center mb-4">
    <h1 class="titulo-seccion">TU CARRITO</h1>
    <p class="subtitulo-seccion">Revisa los productos que has seleccionado</p>
  </div>

  <div class="row">
    <!-- Carrito vacío -->
    <div class="col-lg-8 mb-4" *ngIf="carritoItems.length === 0">
      <div class="mensaje-carrito-vacio">
        <i class="bi bi-cart-x icono-carrito-vacio"></i>
        <h5>Tu carrito está vacío</h5>
        <p>Añade productos desde el catálogo y vuelve aquí para revisarlos.</p>
        <a routerLink="/catalogo" class="btn btn-contorno-primario">Ir al Catálogo</a>
      </div>
    </div>

    <!-- Carrito con productos -->
    <div class="col-lg-8 mb-4" *ngIf="carritoItems.length > 0">
      <div class="tarjeta-resumen">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h5 class="mb-0">Productos en el carrito ({{ totalArticulos }})</h5>
          <button class="btn btn-sm btn-outline-danger" (click)="abrirModalVaciar()">
            <i class="bi bi-trash me-1"></i> Vaciar Carrito
          </button>
        </div>

        <div class="item-carrito mb-3" *ngFor="let item of carritoItems; let i = index">
          <div class="d-flex align-items-center">
            <img [src]="'img/' + item.imagen" [alt]="item.nombre" class="imagen-producto-carrito me-3"
                 (error)="onErrorImagen($event, i)">
            <div class="flex-grow-1">
              <h6 class="mb-1">{{ item.nombre }}</h6>
              <p class="text-muted mb-1">{{ item.club }}</p>
              <p class="mb-1">Talla: <strong>{{ item.talla }}</strong></p>
              <div class="d-flex align-items-center">
                <div class="contador-cantidad me-3">
                  <button class="btn btn-sm btn-outline-secondary" (click)="cambiarCantidad(i, -1)">-</button>
                  <span class="mx-2">{{ item.cantidad }}</span>
                  <button class="btn btn-sm btn-outline-secondary" (click)="cambiarCantidad(i, 1)">+</button>
                </div>
                <strong class="me-3">{{ (item.precio * item.cantidad).toFixed(2) }} €</strong>
                <small class="text-muted me-3">({{ item.precio.toFixed(2) }} € c/u)</small>
                <button class="btn btn-sm btn-outline-danger" (click)="eliminarItem(i)">
                  <i class="bi bi-trash"></i>
                </button>
              </div>
              <small class="text-muted d-block mt-1">Añadido el {{ item.fechaAgregado | date:'dd/MM/yyyy' }}</small>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Resumen -->
    <div class="col-lg-4">
      <div class="tarjeta-resumen">
        <h5 class="mb-3">Resumen del Pedido</h5>
        <div class="d-flex justify-content-between mb-2">
          <span>Productos ({{ totalArticulos }})</span>
          <strong>{{ subtotal.toFixed(2) }} €</strong>
        </div>
        <div class="d-flex justify-content-between mb-2">
          <span>Envío</span>
          <strong>Gratis</strong>
        </div>
        <hr>
        <div class="d-flex justify-content-between mb-3">
          <h6>Total</h6>
          <h6>{{ total.toFixed(2) }} €</h6>
        </div>
        <button class="btn btn-comprar" [disabled]="!carritoItems.length || !isLoggedIn" (click)="procederPago()">
          {{ isLoggedIn ? 'Proceder al Pago' : 'Inicia Sesión para Pagar' }}
        </button>
        <div class="text-center mt-3">
          <a routerLink="/catalogo" class="text-decoration-underline">Seguir comprando</a>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal confirmación -->
<div class="modal-overlay" *ngIf="mostrarModalVaciar" (click)="cerrarModalVaciar()"></div>
<div class="modal-confirmacion" *ngIf="mostrarModalVaciar">
  <div class="modal-contenido">
    <div class="modal-icono"><i class="bi bi-exclamation-triangle"></i></div>
    <h3 class="modal-titulo">¿Vaciar carrito?</h3>
    <p class="modal-mensaje">
      Estás a punto de eliminar <strong>{{ totalArticulos }} producto(s)</strong> por un valor de <strong>{{ total.toFixed(2) }}€</strong>.
    </p>
    <p class="modal-advertencia">Esta acción no se puede deshacer.</p>
    <div class="modal-botones">
      <button class="btn btn-outline-secondary" (click)="cerrarModalVaciar()">
        <i class="bi bi-x-circle me-2"></i> Cancelar
      </button>
      <button class="btn btn-danger" (click)="vaciarCarrito()">
        <i class="bi bi-trash me-2"></i> Sí, Vaciar Carrito
      </button>
    </div>
  </div>
</div>

<!-- Footer -->
<footer class="pie-pagina">
  <div class="container">
    <div class="row">
      <div class="col-md-3 mb-4">
        <h5 class="titulo-pie">CAMISFUT</h5>
        <p>Tu tienda de confianza para camisetas de fútbol nuevas y vintage.</p>
      </div>
      <div class="col-md-3 mb-4">
        <h5 class="titulo-pie">Navegación</h5>
        <ul class="list-unstyled">
          <li><a routerLink="/inicio" class="enlace-pie">Inicio</a></li>
          <li><a routerLink="/catalogo" class="enlace-pie">Catálogo</a></li>
          <li><a routerLink="/colecciones" class="enlace-pie">Colecciones</a></li>
          <li><a routerLink="/nosotros" class="enlace-pie">Nosotros</a></li>
        </ul>
      </div>
      <div class="col-md-3 mb-4">
        <h5 class="titulo-pie">Políticas</h5>
        <ul class="list-unstyled">
          <li><a class="enlace-pie">Envíos</a></li>
          <li><a class="enlace-pie">Devoluciones</a></li>
          <li><a class="enlace-pie">Privacidad</a></li>
          <li><a class="enlace-pie">Términos y Condiciones</a></li>
        </ul>
      </div>
      <div class="col-md-3 mb-4">
        <h5 class="titulo-pie">Síguenos</h5>
        <div class="iconos-redes">
          <a href="#"><i class="bi bi-facebook"></i></a>
          <a href="#"><i class="bi bi-instagram"></i></a>
        </div>
      </div>
    </div>
  </div>
</footer>
